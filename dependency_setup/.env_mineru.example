# MinerU (magic-pdf) environment
#
# Copy this file to .env_mineru and adjust the paths for your machine:
#   cp dependency_setup/.env_mineru.example dependency_setup/.env_mineru
# Then source it before running the pipeline:
#   source dependency_setup/.env_mineru

# ---------------------------------------------------------------------------
# Shared weights root (all backends look under subdirectories here)
# ---------------------------------------------------------------------------
export GLOSSAPI_WEIGHTS_ROOT=/path/to/glossAPI/model_weights

# ---------------------------------------------------------------------------
# OCR control â€” set ENABLE_OCR=1 to run real magic-pdf; ENABLE_STUB controls
# fallback to stub when the CLI fails or is unavailable.
# ---------------------------------------------------------------------------
export GLOSSAPI_MINERU_ENABLE_OCR=1
export GLOSSAPI_MINERU_ENABLE_STUB=0

# ---------------------------------------------------------------------------
# magic-pdf binary location
# Auto-detected via PATH if not set; set explicitly when using a venv.
# ---------------------------------------------------------------------------
export GLOSSAPI_MINERU_COMMAND=/path/to/glossAPI/dependency_setup/.venvs/mineru-py312/bin/magic-pdf

# ---------------------------------------------------------------------------
# Pipeline execution mode: auto | fast | accurate
# ---------------------------------------------------------------------------
export GLOSSAPI_MINERU_MODE=auto

# ---------------------------------------------------------------------------
# Backend engine override: pipeline | hybrid-auto-engine | auto (default)
# auto resolves to hybrid-auto-engine on MPS/CUDA machines and pipeline on CPU.
# ---------------------------------------------------------------------------
# export GLOSSAPI_MINERU_BACKEND=auto

# ---------------------------------------------------------------------------
# Device mode: mps | cuda | cpu  (auto-detected from torch if not set)
# ---------------------------------------------------------------------------
# export GLOSSAPI_MINERU_DEVICE_MODE=mps

# ---------------------------------------------------------------------------
# MinerU tools config JSON.
# Auto-resolved from GLOSSAPI_WEIGHTS_ROOT/mineru/magic-pdf.json if not set.
# Explicit override:
# ---------------------------------------------------------------------------
# export MINERU_TOOLS_CONFIG_JSON=/path/to/glossAPI/model_weights/mineru/magic-pdf.json

# ---------------------------------------------------------------------------
# Page batch size for MinerU inference.
# MinerU processes the PDF in chunks of this many pages, running the full
# model stack (Layout, MFD, MFR, OCR) per chunk before moving to the next.
# Set above your document's page count to avoid mid-document splits and
# the associated Layout/MFD re-warmup overhead.
# ---------------------------------------------------------------------------
# export MINERU_MIN_BATCH_INFERENCE_SIZE=500

# ---------------------------------------------------------------------------
# Enable / disable optional model passes.
# Set to 0 to skip the pass entirely (saves time on text-only documents).
# Set to 1 to force-enable regardless of the base magic-pdf.json setting.
# Quality is preferred over speed: both passes are enabled by default.
# ---------------------------------------------------------------------------
export GLOSSAPI_MINERU_FORMULA_ENABLE=1
export GLOSSAPI_MINERU_TABLE_ENABLE=1
# ---------------------------------------------------------------------------

# ---------------------------------------------------------------------------
# MPS allocator watermarks (Apple Silicon only).
# Default (0.0): disables PyTorch's synchronous budget GC entirely.
# PyTorch then relies on macOS system pressure events, which are asynchronous
# and don't stall the GPU during MFR autoregressive decoding.
# Set to "off" to skip injection and revert to PyTorch's own default (1.7).
# Set to a float > 0 (e.g. 1.0) to use ratio-based GC instead.
# ---------------------------------------------------------------------------
# export GLOSSAPI_MINERU_MPS_HIGH_WATERMARK_RATIO=0.0

# ---------------------------------------------------------------------------
# Skip Docling bootstrap at import time (not needed for MinerU-only runs).
# ---------------------------------------------------------------------------
export GLOSSAPI_SKIP_DOCLING_BOOT=1
