# DeepSeek-OCR (CUDA/vLLM + MPS/MLX) environment
#
# Copy this file to .env_deepseek_ocr and adjust the paths for your machine:
#   cp dependency_setup/.env_deepseek_ocr.example dependency_setup/.env_deepseek_ocr
# Then source it before running the pipeline:
#   source dependency_setup/.env_deepseek_ocr

# ---------------------------------------------------------------------------
# Shared weights root
# ---------------------------------------------------------------------------
export GLOSSAPI_WEIGHTS_ROOT=/path/to/glossAPI/model_weights

# ---------------------------------------------------------------------------
# Device selection: cuda (vLLM) | mps (MLX on macOS Apple Silicon)
# Auto-detected: mps on macOS, cuda elsewhere.
# ---------------------------------------------------------------------------
# export GLOSSAPI_DEEPSEEK_OCR_DEVICE=cuda

# ---------------------------------------------------------------------------
# OCR control
# ENABLE_OCR=1      → enables the CUDA/vLLM subprocess path
# ENABLE_MLX_OCR=1  → enables the MPS/MLX subprocess path (macOS only)
# ENABLE_STUB=0     → disables fallback stub output (set 1 only for tests)
# ---------------------------------------------------------------------------
export GLOSSAPI_DEEPSEEK_OCR_ENABLE_OCR=1
# export GLOSSAPI_DEEPSEEK_OCR_ENABLE_MLX_OCR=1
export GLOSSAPI_DEEPSEEK_OCR_ENABLE_STUB=0

# ---------------------------------------------------------------------------
# CUDA / vLLM path
# ---------------------------------------------------------------------------
# Python binary inside the DeepSeek-OCR venv (for vLLM subprocess).
export GLOSSAPI_DEEPSEEK_OCR_TEST_PYTHON=/path/to/glossAPI/dependency_setup/.venvs/deepseek-ocr-py313/bin/python

# Path to the vLLM inference script bundled with the model weights.
export GLOSSAPI_DEEPSEEK_OCR_VLLM_SCRIPT=/path/to/glossAPI/model_weights/deepseek-ocr/run_pdf_ocr_vllm.py

# Override model weights directory for CUDA path (default: GLOSSAPI_WEIGHTS_ROOT/deepseek-ocr/).
# export GLOSSAPI_DEEPSEEK_OCR_MODEL_DIR=/path/to/glossAPI/model_weights/deepseek-ocr

# VRAM fraction for vLLM KV-cache (0.5–0.9).
# export GLOSSAPI_DEEPSEEK_OCR_GPU_MEMORY_UTILIZATION=0.85

# Disable FP8 KV cache (set to 1 if your GPU doesn't support it).
# export GLOSSAPI_DEEPSEEK_OCR_NO_FP8_KV=0

# Library path for libjpeg-turbo (required by vLLM image processing).
export GLOSSAPI_DEEPSEEK_OCR_LD_LIBRARY_PATH=/path/to/glossAPI/model_weights/deepseek-ocr/libjpeg-turbo/lib

# Prepend libjpeg-turbo to the linker search path.
export LD_LIBRARY_PATH="$GLOSSAPI_DEEPSEEK_OCR_LD_LIBRARY_PATH:${LD_LIBRARY_PATH:-}"

# ---------------------------------------------------------------------------
# MPS / MLX path (macOS Apple Silicon)
# ---------------------------------------------------------------------------
# HuggingFace MLX model identifier (default: mlx-community/DeepSeek-OCR-8bit).
# export GLOSSAPI_DEEPSEEK_OCR_MLX_MODEL=mlx-community/DeepSeek-OCR-8bit

# Override MLX model weights directory (default: GLOSSAPI_WEIGHTS_ROOT/deepseek-ocr-1-mlx/).
# export GLOSSAPI_DEEPSEEK_OCR_MLX_MODEL_DIR=/path/to/glossAPI/model_weights/deepseek-ocr-1-mlx

# Path to MLX inference script (default: package-embedded mlx_cli.py).
# export GLOSSAPI_DEEPSEEK_OCR_MLX_SCRIPT=/path/to/glossAPI/src/glossapi/ocr/deepseek_ocr/mlx_cli.py

# ---------------------------------------------------------------------------
# Misc
# ---------------------------------------------------------------------------
export GLOSSAPI_SKIP_DOCLING_BOOT=1
